var g=Object.defineProperty;var d=(o,s,i)=>s in o?g(o,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[s]=i;var r=(o,s,i)=>d(o,typeof s!="symbol"?s+"":s,i);import{K as u}from"./vendor-Cm26qdS-.js";function h(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const l="KEYSTONE-IFRAME";class y{constructor(){r(this,"bridge");this.addEventListener(),this.bridge=new u}addEventListener(){window.addEventListener("message",async s=>{if(s&&s.data&&s.data.target===l){const{action:i,params:n,messageId:e}=s.data,t="".concat(i,"-reply");try{switch(i){case"keystone-iframe-ready":this.sendMessageToExtension({action:t,success:!0,messageId:e});break;case"keystone-bridge-init":await this.bridgeInit(t,e);break;case"keystone-bridge-get-keys":await this.getKeys(n,t,e);break;case"keystone-bridge-sign-transaction":await this.signTransaction(n,t,e);break;case"keystone-bridge-sign-personal-message":await this.signPersonalMessage(n,t,e);break;case"keystone-bridge-sign-eip712-message":await this.signEIP712Message(n,t,e);break}}catch(a){this.sendMessageToExtension({action:t,success:!1,messageId:e,error:a.message})}}})}async bridgeInit(s,i){await this.bridge.init(),this.sendMessageToExtension({action:s,success:!0,messageId:i})}async getKeys(s,i,n){const{paths:e}=s,t=await this.bridge.getKeys(e);this.sendMessageToExtension({action:i,success:!0,payload:t,messageId:n})}async signTransaction(s,i,n){const{path:e,rawTx:t,isLegacyTx:a}=s,c=await this.bridge.signTransaction(e,t,a);this.sendMessageToExtension({action:i,success:!0,payload:c,messageId:n})}async signPersonalMessage(s,i,n){const{path:e,message:t}=s,a=await this.bridge.signPersonalMessage(e,t);this.sendMessageToExtension({action:i,success:!0,payload:a,messageId:n})}async signEIP712Message(s,i,n){const{path:e,jsonMessage:t}=s,a=await this.bridge.signEIP712Message(e,t);this.sendMessageToExtension({action:i,success:!0,payload:a,messageId:n})}sendMessageToExtension(s){window.parent.postMessage(s,"*")}}(async()=>new y)();console.log("MetaMask < = > Keystone Bridge initialized from ".concat(window.location,"!"));export{h as __vite_legacy_guard};
